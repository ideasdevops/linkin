version: '3.8'

services:
  linkedin-leads:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: linkin
    environment:
      # Configuración de Python
      - PYTHONUNBUFFERED=1
      
      # Configuración de Chrome
      - CHROME_BIN=/usr/bin/google-chrome-stable
      - DISPLAY=:99
      
      # Configuración de Gmail (opcional)
      - GMAIL_APP_PASSWORD=${GMAIL_APP_PASSWORD:-}
      
      # Configuración de LinkedIn
      - LINKEDIN_KEYWORDS=${LINKEDIN_KEYWORDS:-real estate}
      
    volumes:
      # Persistir cookies de sesión
      - linkedin_cookies:/data/cookies
      # Persistir archivos CSV de salida
      - linkedin_output:/data/output
      # Persistir logs
      - linkedin_logs:/data/logs
    
    # Configuración de red
    network_mode: bridge
    
    # Reiniciar automáticamente si falla (pero no si sale con código 0)
    restart: on-failure
    
    # Configuración de recursos
    shm_size: '2gb'
    
    # Healthcheck
    healthcheck:
      test: ["CMD", "python3", "-c", "import os; exit(0 if os.path.exists('/data/output/output.csv') else 1)"]
      interval: 60s
      timeout: 10s
      retries: 3
      start_period: 120s

volumes:
  linkedin_cookies:
    driver: local
  linkedin_output:
    driver: local
  linkedin_logs:
    driver: local

